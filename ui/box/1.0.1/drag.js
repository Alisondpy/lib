define(function(t){"use strict";var e=t("jquery"),n=e(window),o=e(document),s="createTouch"in document,i=document.documentElement,r=!("minWidth"in i.style),h=!r&&"onlosecapture"in i,a="setCapture"in i,c=e.noop,u={start:s?"touchstart":"mousedown",over:s?"touchmove":"mousemove",end:s?"touchend":"mouseup"},f=s?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},l=function(){this.start=e.proxy(this.start,this),this.over=e.proxy(this.over,this),this.end=e.proxy(this.end,this),this.onstart=this.onover=this.onend=c};return l.types=u,l.prototype={start:function(t){return t=this.startFix(t),o.on(u.over,this.over).on(u.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),o.off(u.over,this.over).off(u.end,this.end),this.onend(t),!1},startFix:function(t){return t=f(t),this.target=e(t.target),this.selectstart=function(){return!1},o.on("selectstart",this.selectstart).on("dblclick",this.end),h?this.target.on("losecapture",this.end):n.on("blur",this.end),a&&this.target[0].setCapture(),t},overFix:function(t){return t=f(t)},endFix:function(t){return t=f(t),o.off("selectstart",this.selectstart).off("dblclick",this.end),h?this.target.off("losecapture",this.end):n.off("blur",this.end),a&&this.target[0].releaseCapture(),t}},l.create=function(t,s,i){i=e.extend({hook:null,onstart:c,onover:c,onend:c},i);var r,h,a,u,f=e(t),d=i.hook?e(i.hook):f,p=new l,v=l.types.start,m=t.className.replace(/^\s|\s.*/g,"")+"-drag-start",x={off:function(){d.off(v,p.start)}};return p.onstart=function(e){var s="fixed"===f.css("position"),c=o.scrollLeft(),l=o.scrollTop(),d=f.width(),p=f.height();r=0,h=0,a=s?n.width()-d+r:o.width()-d,u=s?n.height()-p+h:o.height()-p;var v=f.offset(),x=this.startLeft=s?v.left-c:v.left,g=this.startTop=s?v.top-l:v.top;this.clientX=e.clientX,this.clientY=e.clientY,f.addClass(m),i.onstart.call(t,e,x,g)},p.onover=function(e){var n=e.clientX-this.clientX+this.startLeft,o=e.clientY-this.clientY+this.startTop,s=f[0].style;n=Math.max(r,Math.min(a,n)),o=Math.max(h,Math.min(u,o)),s.left=n+"px",s.top=o+"px",i.onover.call(t,e,n,o)},p.onend=function(e){var n=f.position(),o=n.left,s=n.top;f.removeClass(m),i.onend.call(t,e,o,s)},p.off=function(){d.off(v,p.start)},s?p.start(s):d.on(v,p.start),x},l});