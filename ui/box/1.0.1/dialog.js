define(function(t,e,n){"use strict";var i=t("jquery"),o=t("../../../core/1.0.0/utils/util"),s=t("../../../core/1.0.0/dom/delegator"),u=t("./popup"),d=o.extend,c=o.guid,a=o.each,r=window.document,l={zIndex:1024,title:"",close:!0,clickBlankToHide:!1,content:'<span class="ui-box-loading">Loading..</span>',className:"",width:"",height:"",button:null,buttonClass:"ui-box-btn",buttonClassLight:"autofocus",html:'<div node-type="inner" class="ui-box"><a node-type="close" action-type="close" class="ui-box-iconf ui-box-close">x</a><div node-type="header" class="ui-box-hd"><div node-type="title" class="ui-box-title"></div></div><div node-type="body" class="ui-box-bd"><div node-type="content" class="ui-box-content"></div></div><div node-type="footer" class="ui-box-ft"><div node-type="button" class="ui-box-func"></div></div></div>'},h={},f=function(t){var e=t||(t={}),n=t.id||t.id||c(),o=f.get(n)||this;"string"!=typeof t&&1!==t.nodeType||(t={content:t}),t=d({},l,t),t.original=e;var s,u=t.button||(t.button=[]);if(i.isArray(s=u)||(s=[],u&&"object"==typeof u&&a(u,function(t,e){t.id=e,s.push(t)}),u=t.button=s),u.length>0){var r=!1;a(u,function(e,n){var i=e.id||c();e.autofocus&&(r=!0),t[i]&&d(e,t[i]),e.index=n}),r||(u[u.length-1].autofocus=!0)}return o.emit("init",t),o.initialized?o.options(t).focus():o.init(t),h[n]=o,o};o.inherits(f,u,{init:function(t){var e=this;u.call(e,t);var n=function(t){var n=t.actionValue===!1||t.isDefaultPrevented();n||e.hide()};e._delegator=new s(e.node,{context:e,onDelegate:n}),e.delegate("close",function(t){e.hide()}).once("render",function(){e.initComponents()}).on("destroy",function(){delete h[t.id],e._delegator.destroy()})},options:function(t){var e=this,t=d(e._,t);return e._freeze(!0),a(["title","content","width","height","action","button"],function(n,i){i=t[n],null!=i&&"function"==typeof e[n]&&e[n](i)}),e._freeze(!1).resize(),t.zIndex&&(u.zIndex=t.zIndex),e},initComponents:function(){var t=this,e=t._;t.$("header").hide(),t.$("footer").hide(),t.options(),e.close||t.$("close").css("display","none"),e.clickBlankToHide&&i(t.mask).on("onmousedown"in r?"mousedown":"click",function(){return t.hide(),!1});var n=function(e){var n=e.target,i=n.nodeName,o=/^input|textarea$/i,s=u.current===t,d=e.keyCode;!s||o.test(i)&&"button"!==n.type||27===d&&t.hide()};i(r).on("keydown",n),t.on("destroy",function(){i(r).off("keydown",n)})},delegate:function(t,e,n){var i=this._delegator;return i.on.apply(i,arguments),this},undelegate:function(t,e,n){var i=this._delegator;return i.un.apply(i,arguments),this},content:function(t){var e=this.$("content");return t&&t.nodeType?(i.contains(r,t)&&this.on("beforeremove",function(){i("body").append(t.hide())}),t=i(t),e.empty().append(t.show())):e.html(t),this.resize()},title:function(t){return this.$("title").html(t),this.$("header")[t?"show":"hide"](),this},width:function(t){return""!==t&&(this.$("content").css("width",t),this.resize()),this},height:function(t){return""!==t&&(this.$("content").css("height",t),this.resize()),this},button:function(t){t=t||[];var e=this,n=e._,i="",o=0,s=n.buttonClass;return"string"==typeof t?(i=t,o++):a(t,function(t,u){var d=t.id,c=t.fn||t.callback,a=t.display!==!1,r=t.className||s,l=[r];t.autofocus&&l.push(n.buttonClassLight),"function"==typeof c&&e.delegate(d,c),a&&o++,i+='<button type="button" action-type="'+d+'"'+(a?"":' style="display:none"')+(' class="'+l.join(" ")+'"')+(t.disabled?" disabled":"")+">"+(t.text||t.value)+"</button>"}),e.$("button").html(i),e.$("footer")[o?"show":"hide"](),e.resize(),e},action:function(t){var e=this;return a(t,function(t,n){e.delegate(n,t)}),e}}),f.getCurrent=function(){return u.current},f.get=function(t){return void 0===t?h:h[t]},f.config=function(t){t&&d(l,t)},n.exports=f});