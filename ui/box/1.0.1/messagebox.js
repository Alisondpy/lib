define(function(e,n,t){"use strict";var i=e("jquery"),o=e("../../../core/1.0.0/utils/util"),r=e("./drag"),a=e("./dialog"),c=o.each,u=o.extend,s=window.clearTimeout,f="//s1.zhongzhihui.com/lib/assets/images/loading/loading32x32.gif";!function(){var e=i('<i class="ui-box-iconf" style="position:absolute;left:-999em;top:-999em;">x<img src="'+f+'"</i>').appendTo("body");setTimeout(function(){e.remove(),e=null},50)}();var l={info:"&#x69;",warn:"&#x21;",confirm:"&#x3f;",ok:"&#x2714;",error:"&#x2718;",loading:'<img src="'+f+'" />'},d=function(e){var n=l[e];return n?'<i node-type="icon" class="x-icon ui-box-iconf">'+n+"</i>":""},h=o.guid("__x")+"$",m=function(e){return h+e},v=function(e,n){var t,i=n.xtype,o=i&&d(i)||n.iconHTML;return o&&(t=e?'<div node-type="text" class="x-text">'+e+"</div>":"",e=['<div class="ui-box-x-wrap">',o,t,"</div>"].join("")),e},g=function(e){var n=e.contentWindow;if(n)try{return n.document}catch(e){return 0}},p=function(e){var n;e.once("init",function(t){var i={};c(["title","width","height","button"],function(e){i[e]=t[e],delete t[e]}),e.once("load",function(){var t=e._;c(i,function(i,o){if(i)if("title"===o){if("auto"===i)try{i=n.contentWindow.document.title||""}catch(e){i=""}i&&e.title(i)}else"function"==typeof e[o]?e[o](i):t[o]=i})})}).once("render",function(){var t=e._;setTimeout(function(){n=x(e,t.url),e.iframeNode=n},30);var o=t.original;if(!(o instanceof Object))for(var r=function(){e.hide().destroy()},a=0;a<frames.length;a++)try{if(o instanceof frames[a].Object){i(frames[a]).one("unload",r);break}}catch(e){}}).once("beforeremove",function(){i(n).attr("src","about:blank").remove()},!1)},x=function(e,n){var t=e._,o=e.$("content"),r=o.find("iframe"),a=r&&r[0],c=function(n){e._freeze(!0),n&&(t.width||e.width(n.width),t.height||e.height(n.height)),e.emit("load"),e._freeze(!1).resize(),c=null,r.removeAttr("style"),r=a=null},u=function(n){t.showing?e.once("shown",n):n()};if(!r.length){var s=/(msie) ([\w.]+)/.test(navigator.userAgent.toLowerCase()),f='<iframe id="{id}-iframe" name="{id}-iframe" class="iframe" frameborder="0" hspace="0"'+(s?' allowtransparency="true"':"")+' scrolling="'+t.scrolling+'" style="position:absolute;left:-9999em;top:-9999em;" src="'+n+'"></iframe>';r=i(f.replace(/{id}/g,t.id)).appendTo(o),a=r[0],t.autoSize?r.one("load",function(){var e,n,t,o=g(a),s=o&&i(o);s&&(e=s.width(),r.width(e),n=s.height(),t={width:e,height:n}),u(function(){c(t)})}):u(function(){c()})}return a},y=function(e){var n=this;e=u({},e);var t=e.button||(e.button=[]);c(["cancel","ok"],function(n,i){var o=e[n];o&&"object"==typeof o&&(o.id=n,t.push(o),delete e[n])});var o=e.xtype;if(o)e.id=e.id||m(o),e.content=v(e.content,e),"none"!==o&&(e.className=(e.className||"")+" ui-box-x-"+o);else{var s=e.url;if(s){var f=e.close!==!1;e=u({modal:!0,close:!1,autoRelease:!0,autoSize:!0,scrolling:"auto"},e);var l=i(v("Loading...",{xtype:"loading"})).addClass("ui-box-x-loading");e.content=l,e.className=(e.className||"")+" ui-box-iframe",n.once("load",function(){l.remove(),l=null,f&&n.$("close").show()}),n.on("hidden",function(){n.destroy()}),p(n)}}return n=a.call(n,e)||n,n._ready||n.once("render",function(){var t=n.$("title");if(t.length&&e.drag!==!1){t.css("cursor","move");r.create(n.node,null,{hook:t,onstart:function(){n.anchor||n.focus()}})}}),n},w="__showDelay",_="__hideTimer";o.inherits(y,a,{show:function(e,n){var t=this,i=t._,r=[].slice.call(arguments),n=u({},i,n),a=n.duration||0,c=n.delay||0,f=function(){o.each([w,_],function(e,n){n=i[e],delete i[e],n&&s(n)})},l=function(){a>0&&(i[_]=setTimeout(function(){f(),t.hide()},a),t.once("hide",f)),y.__super__.show.apply(t,r)};return f(),c>0?i[w]=setTimeout(l,c):l(),t},hide:function(){var e=this,n=e._;return n&&o.each([w,_],function(e,t){t=n[e],delete n[e],t&&s(t)}),y.__super__.hide.apply(e,arguments),e}}),y.config=a.config,y.get=function(e){if(e){var n,t,i=a.get();if(e&&(n=e.frameElement))for(var o in i)if(i.hasOwnProperty(o)&&(t=i[o],t.iframeNode===n))return t;return i[e]}},t.exports=y});