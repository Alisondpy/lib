define(function(t,e,a){"use strict";function r(t,e){this.opt={},this.selector=t,o.extend(this.opt,e)}function n(t){return t&&t.indexOf("-")>-1?new Date(t.replace(/-/gm,"/")).getTime():t}function i(t,e){var a=this;if("string"!=typeof t)throw"lack of selector";o.extend(l,e),o(t).each(function(){var t=o(this).attr("data-start-time")||l.startTime;t=n(t);var e=o(this).attr("data-end-time")||l.endTime;e=n(e);var i=o(this).attr("data-pattern")||l.pattern;if(null==t||null==e)return!1;var s=new r(this,l);s.init(parseInt(t),parseInt(e),i),o.each(p,function(t,e){s.on(e,function(){a.emit(e)})})})}var o=t("jquery"),s=t("lib/core/1.0.0/event/emitter"),d=(t("lib/core/1.0.0/io/request"),t("lib/gallery/datetime/1.0.0/datetime")),f=d.getServerTime,l={url:"",pattern:"dd:hh:mm:ss"},p=["start","end"];r.prototype={init:function(t,e,a){var r=this;r._o=o(r.selector),f(function(n){var i=!(n<t);r._startTime=n||t,r._endTime=e,r._pattern=a,r._createTime(i)})},_formatZero:function(t){var t=parseInt(t,10);return t>0?(t<=9&&(t="0"+t),String(t)):"00"},_hasType:function(t){return this._pattern.indexOf(t+":")>-1||this._pattern.indexOf(":"+t)>-1},_addTagB:function(t,e){var a=this,r="",n=t.length>1;if(e.length>1)for(var i=0;i<e.length;i++)r+=e.slice(i,i+1),n&&a._appendToBox(t+i,e.slice(i,i+1));else r=e,n&&a._appendToBox(t,e);return!n&&r},_appendToBox:function(t,e){if(!e||0==e.length)return!1;var a=this,r=t.slice(0,1),n=a._o.find("[node-type="+t+"]");n&&n.length>0?a["_$"+r]=n:(a._o.append('<span node-type="'+t+'" class="'+t+'"></span>'),a["_$"+r]=a._o.find("[node-type="+t+"]"));var i=a["_$"+r];(void 0==i.attr("data-txt")||i.attr("data-txt")!=e&&!i.is(":hidden"))&&(i.attr("data-txt",e),i.html(e))},_bindTime:function(t,e,a,r,n){var i=this,o=0,s=[e,a,r,n],d=i._pattern.split(":");i._hasType("d")?i._appendToBox(d[0],i._addTagB(d[0],t)):s[0]=i._formatZero(1*e);for(var f=0;f<d.length;f++)"d"!=d[f]&&"dd"!=d[f]&&(o++,i._appendToBox(d[f],i._addTagB(d[f],s[o-1])))},_createTime:function(t){function e(){a._startTime=a._startTime+100,n+=100,n!=(new Date).getTime()&&(a._startTime=a._startTime+((new Date).getTime()-n),n=(new Date).getTime());var e=(a._endTime-a._startTime)/1e3;if(e>0&&t){var o=a._formatZero(e%60),s=Math.floor(e/60)>0?a._formatZero(Math.floor(e/60)%60):"00",d=Math.floor(e/3600)>0?a._formatZero(Math.floor(e/3600)%24):"00",f=Math.floor(e/86400)>0?a._formatZero(Math.floor(e/86400)):"00";a._bindTime(f,d,s,o,r),0==r?r=9:r--}else a._bindTime("00","00","00","00","0"),a.emit("end",a.selector),clearInterval(i)}var a=this,r=9,n=(new Date).getTime(),i=setInterval(e,100)}},s.applyTo(r),s.applyTo(i),a.exports=i});