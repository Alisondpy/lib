define(function(t,e,i){"use strict";function n(t){return this instanceof n?(this.defaultSetting=a.extend(this,this.defaultSetting,t||{}),this._pools=[],void this.init()):new n(t)}var a=t("jquery"),r=t("../../../core/1.0.0/utils/daemon"),o=t("../../datetime/1.0.0/datetime"),l=Math.floor,s=o.now,c=o.getServerTime,u=function(t){var t=parseInt(t,10);return t>0?(t<=9&&(t="0"+t),String(t)):"00"};n.prototype={defaultSetting:{currentTime:null,labelCtn:"b",isShowArea:!1,targetTime:null,isShowTimeText:!0,timeText:["天","时","分","秒","毫秒"],textLabel:"em",type:{d:!1,h:!0,m:!0,s:!0,ms:!1},callback:function(){},afterGetTime:function(){},container:null},init:function(){var t=this,e=+t.defaultSetting.serverTime,i=function(e){a(t.container).each(function(){t.afterGetTime(a(this),e),e&&a(this).attr("data-startTime",e);var i=t._countDown(a(this));t._pools.push(i)})};t.showTimeText(),e?i(e):c(function(t){i(t)})},showTimeText:function(){this.timeText=this.isShowTimeText?this.timeText:["","","","",""]},createTextLabel:function(t){var e=this,i=e.timeText[t];return""!=e.textLabel&&""!=i&&(i="<"+e.textLabel+">"+e.timeText[t]+"</"+e.textLabel+">"),i},_countDown:function(t){function e(t,e,n,r,l){var s="",c=0,h=[e,n,r,l];a.type.d?s+=i(t,a.type.d)+a.createTextLabel(0):e=u(1*e+24*t);for(var f in a.type)a.type[f]&&"d"!=f&&(c++,s+=i(h[c-1],a.type[f])+a.createTextLabel(c));o.html(s)}function i(t,e){var i="",n="";if(e&&e.length>0&&(i=' class="'+e+'"'),t.length>1&&a.isShowArea)for(var r=0;r<t.length;r++)n+="<"+a.labelCtn+i+"><i></i>"+t.slice(r,r+1)+"</"+a.labelCtn+">";else n="<"+a.labelCtn+i+">"+t+"</"+a.labelCtn+">";return n}function n(){f+=1e3,d+=1e3;var i=s();d!=i&&(f+=i-d,d=i);var n=(m-f)/1e3,o=l(n/3600);if(n>0){var c=u(n%60),h=l(n/60)>0?u(l(n/60)%60):"00",p=l(n/3600)>0?u(a.type.d?o%24:o):"00",v=l(n/86400)>0?u(l(n/86400)):"00";e(v,p,h,c,T),0==T?T=9:T--}else r.cancel(x),e("00","00","00","00","0"),a.callback(t)}var a=this,o=t,c=o.attr("data-endTime"),h=o.attr("data-startTime"),f=a.currentTime,m=a.targetTime;if(m=+(c?c:m),f=+(h?h:f),!f||!m)return!1;var T=9,d=s(),x=r.loop(n,1e3);return x},destroy:function(){a.each(this._pools,function(t,e){r.cancel(e)}),this._pools.length=0}},i.exports=n});