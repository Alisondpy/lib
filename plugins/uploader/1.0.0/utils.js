define(function(e,t,n){"use strict";function i(e){return"number"==typeof e}function a(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function r(e,t,n){var i=e.width,a=e.height,r=i/a;return i>0&&a>0&&(r>=t/n?i>t&&(i=t,a=i/r):a>n&&(a=n,i=a*r)),{width:~~i,height:~~a}}function o(e,t){t=t||{};var n,a,o=t.quality||.9,u=t.format,h=t.mimetype||"image/jpeg",c=e.naturalWidth||e.width,d=e.naturalHeight||e.height;if(i(n=t.width)&&i(a=t.height)){var g=r({width:c,height:d},n,a);c=g.width,d=g.height}o>1&&(o/=100),void 0!==u&&"png"===u&&(h="image/png");var l=f.createElement("canvas");l.width=c,l.height=d;var m=(l.getContext("2d").drawImage(e,0,0,c,d),l.toDataURL(h,o)),w=new Image;return w.src=m,w}function u(e,t,n){var i=new Image;i.onload=function(e){var a=o(i,t);n(a.src)},i.src=e}function h(e,t,n){"undefined"!=typeof FileReader&&/image/i.test(e.type)?c(e,function(i){var r=new Image;r.onload=function(i){var u=o(r,a({mimetype:e.type},t));n(d(u.src))},r.src=i}):n(e)}function c(e,t){var n=new FileReader;n.onload=function(e){t(n.result),n=n.onload=null},n.readAsDataURL(e)}function d(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),a=i.length,r=new Uint8Array(a);a--;)r[a]=i.charCodeAt(a);return new Blob([r],{type:n})}var f=window.document;t.genImageFileThumbnail=function(e,t,n){"undefined"!=typeof FileReader&&/image/i.test(e.type)?c(e,function(e){u(e,t,n)}):n(null)},t.scaleImageFile=h});