define(function(e,t,i){"use strict";function o(e){var t=this;t._options=e=n.extend({},p,e);var i=t._options.selected.length;if(0!=t._options.limit&&i>t._options.limit)throw new Error("the selected count exceed the limit.");t.el=n(t._make()),t._nodes=d.parse(t.el,!1),t._items=[],t._activeItem=null;for(var o=0;o<i;o++){var s=new c(t._options.selected[o]);t.add(s)}t._onEvent()}var n=e("jquery"),s=e("lib/core/1.0.0/event/emitter"),r=e("lib/ui/box/1.0.1/box"),l=e("lib/core/1.0.0/utils/util"),d=e("lib/core/1.0.0/dom/build"),c=e("./item"),p={limit:0,selected:[]};l.inherits(o,s),o.prototype.$=function(e,t){var i=this._nodes||(this._nodes={}),o=i[e];return(!o||t&&0===o.length)&&(o=this.el.find('[node-type="'+e+'"]'),t&&o.length>0&&(i[e]=o)),!t||o.length?o:null},o.prototype.updateSelectedTips=function(){var e=this;e._nodes["selected-count"].html(e._items.length),e._options.limit>0&&e._nodes.limit.html("/"+e._options.limit)},o.prototype._onEvent=function(){var e=this;e._nodes.del.on("click",function(){e._activeItem.destroy(),e.remove(e._activeItem)}),e._nodes.moveup.on("click",function(){e._order(e._activeItem,"moveup")}),e._nodes.movedown.on("click",function(){e._order(e._activeItem,"movedown")})},o.prototype._offEvent=function(){var e=this;e._nodes.del.off("click"),e._nodes.moveup.off("click"),e._nodes.movedown.off("click")},o.prototype._order=function(e,t){var i,o=this,n=o._items;if(!e)return this;for(var s=0,r=n.length;s<r;s++)if(e===n[s])if(i=n[s],"moveup"===t){if(s>0){n[s]=n[s-1],n[s-1]=i,n[s-1].el.insertBefore(n[s].el);break}}else if(s<r-1){n[s]=n[s+1],n[s+1]=i,n[s].el.insertBefore(n[s+1].el);break}return this},o.prototype.add=function(e){if(void 0===e)throw new Error("the param [item] is require.");var t=this,i=t._items;return 0!=t._options.limit&&i.length>=t._options.limit?void r.error("超过最大数量（"+t._options.limit+"）限制"):("string"==typeof e&&(e=new c(e)),void(t._isExistItem(e)||(t._nodes["selected-images"].append(e.el),t._items.push(e),t._nodes["selected-images"].stop().animate({scrollTop:87*t._items.length},1e3),e.on("del",function(){t.remove(this)}),e.on("activate",function(){for(var e=0,i=t._items.length;e<i;e++)this===t._items[e]?t._activeItem=this:t._items[e].deactivate()}),t.updateSelectedTips())))},o.prototype._isExistItem=function(e){for(var t=this,i=t._items,o=0,n=i.length;o<n;o++)if(i[o]===e)return!0;return!1},o.prototype.remove=function(e){for(var t=this,i=0;i<t._items.length;i++)if(e===this._items[i]){this._items.splice(i,1),t.updateSelectedTips(),t.emit("del");break}return this},o.prototype.getUrls=function(){for(var e=this,t=[],i=e._items,o=0,n=i.length;o<n;o++)t.push(i[o].url);return t},o.prototype._make=function(){var e="";return e+="<div>",e+='    <div class="selected-tips">',e+='        已选择图片(<span node-type="selected-count">0</span><span node-type="limit"></span>)',e+="    </div>",e+='    <div class="selected-op">',e+='        <a href="javascript:;" node-type="moveup">上移</a>',e+='        <a href="javascript:;" node-type="movedown">下移</a>',e+='        <a href="javascript:;" node-type="del">删除</a>',e+="    </div>",e+='    <ul class="selected-images" node-type="selected-images">',e+="    </ul>",e+="</div>"},i.exports=o});