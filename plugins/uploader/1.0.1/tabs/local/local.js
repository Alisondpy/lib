define(function(t,i,e){"use strict";function o(t){var i=this,e={type:"local",title:"本地上传",fileTypeExts:"*.png;*.jpg;*.gif;*.bmp",fileTypeDesc:"图片文件，支持:.png,.jpg,.gif,.bmp",fileSizeLimit:"2048KB",formData:{},swf:"http://s1.zhongzhihui.com/lib/plugins/uploader/1.0.1/uploadify.swf",uploader:"/api/upload.php",buttonText:"本地上传",buttonClass:"",height:54,width:"auto",debug:!1,itemTemplate:null,showPreview:!1,overrideEvents:["onSelect"],onSelect:function(t){i.uploading(!0);var e=new r(t);i.add(e)},onUploadProgress:function(t,e,o){i.updateCount();var n=i.getItem(t);n&&n.progress(e,o)},onUploadSuccess:function(t,e,o){var n=i.getItem(t);n&&(i.emit("add",e.data.url),i.remove(n))},onQueueComplete:function(){i.uploading(!1)},onFallback:function(){l.error("sorry,flash不兼容！")}};i._options=t=n.extend({},e,t),i._items=[],p.apply(i,[i._options])}var n=t("jquery"),l=(t("lib/core/1.0.0/event/emitter"),t("lib/ui/box/1.0.1/box")),s=t("lib/core/1.0.0/utils/util"),a=(t("lib/core/1.0.0/dom/build"),t("lib/plugins/uploadify/3.2.2/uploadify")),p=t("../widget"),r=t("./item");s.inherits(o,p),o.prototype._init=function(){var t=this;t.uploader=a.uploadify(t._nodes["btn-upload"][0],t._options),t._onEvent()},o.prototype.add=function(t){var i=this;i._items;i._isExistItem(t)||(i._nodes["img-list"].append(t.el),i._items.push(t),i._nodes["img-list"].stop().animate({scrollTop:i._items.length/4*87},1e3),t.on("del",function(){i.remove(t)}))},o.prototype._isExistItem=function(t){for(var i=this,e=i._items,o=0,n=e.length;o<n;o++)if(e[o]===t)return!0;return!1},o.prototype.getItem=function(t){for(var i=this,e=0;e<i._items.length;e++)if(t.id===i._items[e].file.id)return i._items[e];return null},o.prototype.remove=function(t){for(var i=this,e=0;e<i._items.length;e++)if(t===this._items[e]){i.uploader.cancel(t._options.id),t.destroy(),this._items.splice(e,1);break}return this},o.prototype.uploading=function(t){var i=this;t?i.container.addClass("local-container-uploading"):i.container.removeClass("local-container-uploading")},o.prototype._onEvent=function(){var t=this;t._nodes.cancel.on("click",function(){for(var i=0;i<t._items.length;i++)t.remove(t._items[i]);t.uploading(!1)})},o.prototype._offEvent=function(){var t=this;t._nodes.cancel.off("click")},o.prototype.updateCount=function(){var t=this;t._nodes.count.html(t._items.length)},o.prototype._makeContainer=function(){var t=this,i="";return i+='<div class="local-container">',i+='    <div class="local-init" node-type="local-init">',i+='        <div class="local-tips" node-type="local-tips">按住Ctrl可多选图片</div>',i+='        <div class="btn btn-primary btn-lg '+t._options.buttonClass+'"><button node-type="btn-upload"><span class="glyphicon glyphicon-upload"></span>选择上传</button></div>',i+="    </div>",i+='    <div class="local-uploading" node-type="local-uploading">',i+='        <div class="local-op clearfix">',i+='            <a class="btn btn-primary btn-xs" node-type="cancel" href="javascript:;"><span class="glyphicon glyphicon-remove"></span>取消上传</a><div><b node-type="count">0</b>张图片等待上传</div>',i+="        </div>",i+='        <ul class="img-list clearfix" node-type="img-list">',i+="        </ul>",i+="    </div>",i+="</div>"},e.exports=o});