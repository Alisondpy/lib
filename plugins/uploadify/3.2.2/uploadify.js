!function e(t,e,a){if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof module)a(require,module.exports,module);else{var i={exports:{}};a(null,i.exports,i),t[e]=i.exports}}(this,"Uploadify",function(e,t,a){"use strict";function i(e,t){var a=-1,i=e.length;if(e.forEach)e.forEach(t);else if(i)for(;++a<i;)t(e[a],a);else for(a in e)e.hasOwnProperty(a)&&t(e[a],a)}function u(e){var t={width:e.offsetWidth,height:e.offsetHeight},a={width:["left","right"],height:["top","bottom"]},u=n(e);return i(t,function(e,o){i(a[o],function(t,a){e-=parseInt(u.css("border-"+t+"-width"),10)||0}),t[o]=e}),t}function o(e){return e=e||"",e+(++f).toString(32)}function s(e,t){e=e||{};var a=n(e),i=Array.prototype.slice;return t=t||e.name,n.each({on:"on",un:"off",once:"one",emit:"trigger"},function(u,o){e[u]=function(e){var s=i.call(arguments,0),l=s[1];return t&&!~e.indexOf(".")&&(s[0]=e+"."+t),"function"==typeof l&&("on"===u||"once"===u?s[1]=l.__||(l.__=function(e){return e.preventDefault(),l.apply(this,i.call(arguments,1))}):"un"===u&&(s[1]=l.__)),a[o].apply(a,s)}}),e}function l(e){return e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()})}function r(e,t,a){var i=this,u=n.extend({},t),r=n(e);if(!r[0])throw Error("Initialize flash upload error, invalid holder node.");u.uploader=u.endpoint||u.uploader,u.id||(u.id=o("__file__")),s(i);var d=["cancel","clearQueue","destroy","dialogClose","dialogOpen","disable","enable","initError","fallback","queueComplete","selectError","select","SWFReady","uploadComplete","uploadError","uploadSuccess","uploadProgress","uploadStart"];n.each(d,function(e,a,o){o="on"+l(a),u[o]=function(){i.handleEvent(a,Array.prototype.slice.call(arguments))},t[o]&&i.on(a,t[o])}),u.showPreview&&i.on("uploadSuccess",function(e,t,a){i.showPreview((t.data||0).url)}),i.once("destroy",function(){i.un(),r.off(),r=null}),i.$holder=r,i.swfupload=null,setTimeout(function(){i.init(u,a);var e=i.swfupload=r.data("uploadify");e||i.emit("initError",Error("Flash upload installation failed."))},1)}var n=e("jquery"),d=e("../../swfobject/2.3/swfobject"),c=e("../../swfupload/2.2/swfupload"),p={init:function(e,t){return this.each(function(a,i){var o=n(i),s=o.clone(),l=n.extend({id:o.attr("id"),swf:"uploadify.swf",uploader:"uploadify.php",auto:!0,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:!1,debug:!1,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",height:30,itemTemplate:!1,method:"post",multi:!0,formData:{},preventCaching:!0,progressData:"percentage",queueID:!1,queueSizeLimit:999,removeCompleted:!0,removeTimeout:3,requeueErrors:!1,successTimeout:30,uploadLimit:0,width:120,overrideEvents:[]},e),p={assume_success_timeout:l.successTimeout,button_placeholder_id:l.id,button_width:l.width,button_height:l.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:l.multi?c.BUTTON_ACTION.SELECT_FILES:c.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:"arrow"==l.buttonCursor?c.CURSOR.ARROW:c.CURSOR.HAND,button_window_mode:c.WINDOW_MODE.TRANSPARENT,debug:l.debug,requeue_on_error:l.requeueErrors,file_post_name:l.fileObjName,file_size_limit:l.fileSizeLimit,file_types:l.fileTypeExts,file_types_description:l.fileTypeDesc,file_queue_limit:l.queueSizeLimit,file_upload_limit:l.uploadLimit,flash_url:l.swf,prevent_swf_caching:l.preventCaching,post_params:l.formData,upload_url:l.uploader,use_query_string:"get"==l.method,file_dialog_complete_handler:h.onDialogClose,file_dialog_start_handler:h.onDialogOpen,file_queued_handler:h.onSelect,file_queue_error_handler:h.onSelectError,swfupload_loaded_handler:l.onSWFReady,upload_complete_handler:h.onUploadComplete,upload_error_handler:h.onUploadError,upload_progress_handler:h.onUploadProgress,upload_start_handler:h.onUploadStart,upload_success_handler:h.onUploadSuccess};t&&(p=n.extend(p,t)),p=n.extend(p,l);var f=d.getFlashPlayerVersion(),D=f.major>=9;if(D){var E=l.id;if(!n("#uploadify-css")[0]){var m=".uploadify-button-wrapper{position:absolute;top:0;left:0;}";n("head").append('<style type="text/css" id="uploadify-css">'+(l.css||m)+(l.cssAddon||"")+"</style>")}"static"===o.css("position")&&o.css("position","relative");var g=u(i),_=o,q=n('<div class="uploadify-button-wrapper"><div id="'+E+'"></div></div>').appendTo(o);q.css(g);var v=new c(n.extend(p,{button_width:g.width,button_height:g.height}));if(o.data("uploadify",v),q.attr("id",E).data("uploadify",v).delegate(".cancel a","click",function(e){var t=n(e.target).data("file-id");t&&r.call(E,"cancel",t)}),!l.queueID){var S=n("<div />",{id:l.id+"-queue",class:"uploadify-queue"});q.after(S),v.settings.queueID=l.id+"-queue",v.settings.defaultQueue=!0}v.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"},v.original=s,v.wrapper=q,v.button=_,v.queue=S,l.onInit&&l.onInit.call(o,v)}else l.onFallback&&l.onFallback.call(o)})},cancel:function(e,t){var a=arguments;this.each(function(){var e=n(this),t=e.data("uploadify"),i=t.settings,u=-1;if(a[0])if("*"==a[0]){var o=t.queueData.queueLength;n("#"+i.queueID).find(".uploadify-queue-item").each(function(){u++,a[1]===!0?t.cancelUpload(n(this).attr("id"),!1):t.cancelUpload(n(this).attr("id")),n(this).find(".data").removeClass("data").html(" - Cancelled"),n(this).find(".uploadify-progress-bar").remove(),n(this).delay(1e3+100*u).fadeOut(500,function(){n(this).remove()})}),t.queueData.queueSize=0,t.queueData.queueLength=0,i.onClearQueue&&i.onClearQueue.call(e,o)}else for(var s=0;s<a.length;s++)t.cancelUpload(a[s]),n("#"+a[s]).find(".data").removeClass("data").html(" - Cancelled"),n("#"+a[s]).find(".uploadify-progress-bar").remove(),n("#"+a[s]).delay(1e3+100*s).fadeOut(500,function(){n(this).remove()});else{var l=n("#"+i.queueID).find(".uploadify-queue-item").get(0);$item=n(l),t.cancelUpload($item.attr("id")),$item.find(".data").removeClass("data").html(" - Cancelled"),$item.find(".uploadify-progress-bar").remove(),$item.delay(1e3).fadeOut(500,function(){n(this).remove()})}})},destroy:function(){this.each(function(){var e=n(this),t=e.data("uploadify"),a=t.settings;t.destroy(),a.defaultQueue&&n("#"+a.queueID).remove(),n("#"+a.id).replaceWith(t.original),a.onDestroy&&a.onDestroy.call(this),t=null})},disable:function(e){this.each(function(){var t=n(this),a=t.data("uploadify"),i=a.settings;e?(a.button.addClass("disabled"),i.onDisable&&i.onDisable.call(this)):(a.button.removeClass("disabled"),i.onEnable&&i.onEnable.call(this)),a.setButtonDisabled(e)})},settings:function(e,t,a){var i=arguments,u=t;if(this.each(function(){var o=n(this),s=o.data("uploadify"),l=s.settings;if("object"==typeof i[0])for(var r in t)setData(r,t[r]);if(1===i.length)u=l[e];else{switch(e){case"uploader":s.setUploadURL(t);break;case"formData":a||(t=n.extend(l.formData,t)),s.setPostParams(l.formData);break;case"method":"get"==t?s.setUseQueryString(!0):s.setUseQueryString(!1);break;case"fileObjName":s.setFilePostName(t);break;case"fileTypeExts":s.setFileTypes(t,l.fileTypeDesc);break;case"fileTypeDesc":s.setFileTypes(l.fileTypeExts,t);break;case"fileSizeLimit":s.setFileSizeLimit(t);break;case"uploadLimit":s.setFileUploadLimit(t);break;case"queueSizeLimit":s.setFileQueueLimit(t);break;case"buttonImage":s.button.css("background-image",settingValue);break;case"buttonCursor":"arrow"==t?s.setButtonCursor(c.CURSOR.ARROW):s.setButtonCursor(c.CURSOR.HAND);break;case"buttonText":n("#"+l.id+"-button").find(".uploadify-button-text").html(t);break;case"width":s.setButtonDimensions(t,l.height);break;case"height":s.setButtonDimensions(l.width,t);break;case"multi":t?s.setButtonAction(c.BUTTON_ACTION.SELECT_FILES):s.setButtonAction(c.BUTTON_ACTION.SELECT_FILE)}l[e]=t}}),1===i.length)return u},stop:function(){this.each(function(){var e=n(this),t=e.data("uploadify");t.queueData.averageSpeed=0,t.queueData.uploadSize=0,t.queueData.bytesUploaded=0,t.queueData.uploadQueue=[],t.stopUpload()})},upload:function(){var e=arguments;this.each(function(){var t=n(this),a=t.data("uploadify");if(a.queueData.averageSpeed=0,a.queueData.uploadSize=0,a.queueData.bytesUploaded=0,a.queueData.uploadQueue=[],e[0])if("*"==e[0])a.queueData.uploadSize=a.queueData.queueSize,a.queueData.uploadQueue.push("*"),a.startUpload();else{for(var i=0;i<e.length;i++)a.queueData.uploadSize+=a.queueData.files[e[i]].size,a.queueData.uploadQueue.push(e[i]);a.startUpload(a.queueData.uploadQueue.shift())}else a.startUpload()})}},h={onDialogOpen:function(){var e=this.settings;this.queueData.errorMsg="Some files were not added to the queue:",this.queueData.filesReplaced=0,this.queueData.filesCancelled=0,e.onDialogOpen&&e.onDialogOpen.call(this)},onDialogClose:function(e,t,a){var i=this.settings;this.queueData.filesErrored=e-t,this.queueData.filesSelected=e,this.queueData.filesQueued=t-this.queueData.filesCancelled,this.queueData.queueLength=a,n.inArray("onDialogClose",i.overrideEvents)<0&&this.queueData.filesErrored>0&&alert(this.queueData.errorMsg),i.onDialogClose&&i.onDialogClose.call(this,this.queueData),i.auto&&r.call(i.id,"upload","*")},onSelect:function(e){var t=this.settings,a={};for(var i in this.queueData.files)if(a=this.queueData.files[i],1!=a.uploaded&&a.name==e.name){var u=confirm('The file named "'+e.name+'" is already in the queue.\nDo you want to replace the existing item in the queue?');if(!u)return this.cancelUpload(e.id),this.queueData.filesCancelled++,!1;n("#"+a.id).remove(),this.cancelUpload(a.id),this.queueData.filesReplaced++}var o=Math.round(e.size/1024),s="KB";o>1e3&&(o=Math.round(o/1e3),s="MB");var l=o.toString().split(".");o=l[0],l.length>1&&(o+="."+l[1].substr(0,2)),o+=s;var r=e.name;r.length>25&&(r=r.substr(0,25)+"...");var d={fileID:e.id,instanceID:t.id,fileName:r,fileSize:o},c=t.itemTemplate;0==c&&(c=['<div id="${fileID}" class="uploadify-queue-item">','<div class="cancel">','<a href="javascript:;" data-file-id="${fileID}">X</a>',"</div>",'<span class="fileName">${fileName} (${fileSize})</span><span class="data"></span>','<div class="uploadify-progress">','<div class="uploadify-progress-bar"><!--Progress Bar--></div>',"</div>","</div>"].join("")),c&&n.inArray("onSelect",t.overrideEvents)<0&&(c=c.replace(/\$\{([^}]+)\}/g,function(e,t){return d[t]||e}),n("#"+t.queueID).append(c)),this.queueData.queueSize+=e.size,this.queueData.files[e.id]=e,t.onSelect&&t.onSelect.apply(this,arguments)},onSelectError:function(e,t,a){var i=this.settings;if(n.inArray("onSelectError",i.overrideEvents)<0)switch(t){case c.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:i.queueSizeLimit>a?this.queueData.errorMsg+="\nThe number of files selected exceeds the remaining upload limit ("+a+").":this.queueData.errorMsg+="\nThe number of files selected exceeds the queue size limit ("+i.queueSizeLimit+").";break;case c.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+e.name+'" exceeds the size limit ('+i.fileSizeLimit+").";break;case c.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\nThe file "'+e.name+'" is empty.';break;case c.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+e.name+'" is not an accepted file type ('+i.fileTypeDesc+")."}t!=c.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete this.queueData.files[e.id],i.onSelectError&&i.onSelectError.apply(this,arguments)},onQueueComplete:function(){this.settings.onQueueComplete&&this.settings.onQueueComplete.call(this,this.settings.queueData)},onUploadComplete:function(e){var t=this.settings,a=this,i=this.getStats();if(this.queueData.queueLength=i.files_queued,"*"==this.queueData.uploadQueue[0]?this.queueData.queueLength>0?this.startUpload():(this.queueData.uploadQueue=[],t.onQueueComplete&&t.onQueueComplete.call(this,this.queueData)):this.queueData.uploadQueue.length>0?this.startUpload(this.queueData.uploadQueue.shift()):(this.queueData.uploadQueue=[],t.onQueueComplete&&t.onQueueComplete.call(this,this.queueData)),n.inArray("onUploadComplete",t.overrideEvents)<0)if(t.removeCompleted)switch(e.filestatus){case c.FILE_STATUS.COMPLETE:setTimeout(function(){n("#"+e.id)&&(a.queueData.queueSize-=e.size,a.queueData.queueLength-=1,delete a.queueData.files[e.id],n("#"+e.id).fadeOut(500,function(){n(this).remove()}))},1e3*t.removeTimeout);break;case c.FILE_STATUS.ERROR:t.requeueErrors||setTimeout(function(){n("#"+e.id)&&(a.queueData.queueSize-=e.size,a.queueData.queueLength-=1,delete a.queueData.files[e.id],n("#"+e.id).fadeOut(500,function(){n(this).remove()}))},1e3*t.removeTimeout)}else e.uploaded=!0;t.onUploadComplete&&t.onUploadComplete.call(this,e)},onUploadError:function(e,t,a){var i=this.settings,u="Error";switch(t){case c.UPLOAD_ERROR.HTTP_ERROR:u="HTTP Error ("+a+")";break;case c.UPLOAD_ERROR.MISSING_UPLOAD_URL:u="Missing Upload URL";break;case c.UPLOAD_ERROR.IO_ERROR:u="IO Error";break;case c.UPLOAD_ERROR.SECURITY_ERROR:u="Security Error";break;case c.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+a+")."),u="Exceeds Upload Limit";break;case c.UPLOAD_ERROR.UPLOAD_FAILED:u="Failed";break;case c.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case c.UPLOAD_ERROR.FILE_VALIDATION_FAILED:u="Validation Error";break;case c.UPLOAD_ERROR.FILE_CANCELLED:u="Cancelled",this.queueData.queueSize-=e.size,this.queueData.queueLength-=1,(e.status==c.FILE_STATUS.IN_PROGRESS||n.inArray(e.id,this.queueData.uploadQueue)>=0)&&(this.queueData.uploadSize-=e.size),i.onCancel&&i.onCancel.call(this,e),delete this.queueData.files[e.id];break;case c.UPLOAD_ERROR.UPLOAD_STOPPED:u="Stopped"}n.inArray("onUploadError",i.overrideEvents)<0&&(t!=c.UPLOAD_ERROR.FILE_CANCELLED&&t!=c.UPLOAD_ERROR.UPLOAD_STOPPED&&n("#"+e.id).addClass("uploadify-error"),n("#"+e.id).find(".uploadify-progress-bar").css("width","1px"),t!=c.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&e.status!=c.FILE_STATUS.COMPLETE&&n("#"+e.id).find(".data").html(" - "+u));var o=this.getStats();this.queueData.uploadsErrored=o.upload_errors,i.onUploadError&&i.onUploadError.call(this,e,t,a,u)},onUploadProgress:function(e,t,a){var i=this.settings,u=new Date,o=u.getTime(),s=o-this.timer;s>500&&(this.timer=o);var l=t-this.bytesLoaded;this.bytesLoaded=t;var r=this.queueData.queueBytesUploaded+t,d=Math.round(t/a*100),c="KB/s",p=0,h=l/1024/(s/1e3);h=Math.floor(10*h)/10,this.queueData.averageSpeed>0?this.queueData.averageSpeed=Math.floor((this.queueData.averageSpeed+h)/2):this.queueData.averageSpeed=Math.floor(h),h>1e3&&(p=.001*h,this.queueData.averageSpeed=Math.floor(p),c="MB/s"),n.inArray("onUploadProgress",i.overrideEvents)<0&&("percentage"==i.progressData?n("#"+e.id).find(".data").html(" - "+d+"%"):"speed"==i.progressData&&s>500&&n("#"+e.id).find(".data").html(" - "+this.queueData.averageSpeed+c),n("#"+e.id).find(".uploadify-progress-bar").css("width",d+"%")),i.onUploadProgress&&i.onUploadProgress.call(this,e,t,a,r,this.queueData.uploadSize)},onUploadStart:function(e){var t=this.settings,a=new Date;this.timer=a.getTime(),this.bytesLoaded=0,0==this.queueData.uploadQueue.length&&(this.queueData.uploadSize=e.size),t.checkExisting&&n.ajax({type:"POST",async:!1,url:t.checkExisting,data:{filename:e.name},success:function(t){if(1==t){var a=confirm('A file with the name "'+e.name+'" already exists on the server.\nWould you like to replace the existing file?');a||(this.cancelUpload(e.id),n("#"+e.id).remove(),this.queueData.uploadQueue.length>0&&this.queueData.queueLength>0&&("*"==this.queueData.uploadQueue[0]?this.startUpload():this.startUpload(this.queueData.uploadQueue.shift())))}}}),t.onUploadStart&&t.onUploadStart.call(this,e)},onUploadSuccess:function(e,t,a){var i=this.settings,u=this.getStats();this.queueData.uploadsSuccessful=u.successful_uploads,this.queueData.queueBytesUploaded+=e.size,n.inArray("onUploadSuccess",i.overrideEvents)<0&&n("#"+e.id).find(".data").html(" - Complete");try{t=t.replace(/\/\*[\s\S]*?\*\//g,""),t=n.parseJSON(t)}catch(e){}i.onUploadSuccess&&i.onUploadSuccess.call(this,e,t,a)}},f=65536*(1+Math.random())|0;n.extend(r.prototype,p,{constructor:r,each:function(e){this.$holder.each(e)},handleEvent:function(e,t){var a=this;switch(e){case"uploadSuccess":var i=t[0],u=t[1],o=+u.error,s=isNaN(o)||o;s&&(t[2]=!1,e="uploadError",a.cancel(i.id));break;case"uploadError":t=[t[0],{error:t[1],messageg:t[2],data:t[3]}]}a.emit(e,t)}}),r.call=function(e,t){if("string"==typeof e&&(e=n("#"+e)),e[0]&&p[t])return p[t].apply(e,Array.prototype.slice.call(arguments,2));throw Error("The method "+t+" does not exist in `uploadify`")},t=a.exports=r,t.uploadify=function(e,t){var a=n(e),i=a.data("uploader");return i||(i=new r(e,t,arguments[2]),a.data("uploader",i),i)}});