define(function(t,e,n){"use strict";function l(t,e,n){return i.jsonp(t,function(t){var n="object"==typeof t?(t.data||0).html:t;e(n,t)},n)}function a(t,e){t.html(e)}function r(t,e){e=e||{},t=$(t);var n=e.url,r=String(e.rev||""),o=(e.js,e.css,e.cache),i=e.html,u=e.loadingClass,c=e.load||d,f=e.error||d,h=e.complete||d;if(!t.length)throw"Load view by pipe error. view is undefined";if(!n&&!i)throw"Error: The pagelet settings not valid. both pagelet url and html unavailable.";u&&t.addClass(u);var v=function(){u&&t.removeClass(u),h(),v=null,c=null,f=null,h=null},m=o&&p.get(n);m&&m.checksum===r?(i=m.html,s(function(){a(t,i),c(i),v()})):l(n,function(e,l){o&&s(function(){p.set(n,{checksum:r,html:e})}),a(t,e),c(e)},function(t){f(t)}).always(v)}function o(t,e){var n=$(t),e=f({url:n.attr("data-pl-url"),rev:n.attr("data-pl-rev"),cache:!!n.attr("data-pl-cache")},e);return r(n,e)}var i=t("./request"),u=t("../utils/util"),c=t("./storage"),s=u.setImmediate,d=u.noop,f=u.extend,h="v1.0.1",p=c.select("__pl__"+h,"local");n.exports={view:r,pipe:o}});